const cryptoData = [
  {
    icon: "â‚¿",
    name: "BTCUSDT",
    price: "90,744.3",
    change: -4.89,
    amount: "5.39B",
    color: "#f7931a",
  },
  {
    icon: "Îž",
    name: "ETHUSDT",
    price: "3,022.06",
    change: -4.83,
    amount: "4.66B",
    color: "#627eea",
  },
  {
    icon: "S",
    name: "SOLUSDT",
    price: "134.728",
    change: -3.79,
    amount: "726.64M",
    color: "#14f195",
  },
  {
    icon: "X",
    name: "XRPUSDT",
    price: "2.1627",
    change: -4.06,
    amount: "415.75M",
    color: "#23292f",
  },
  {
    icon: "Z",
    name: "ZECUSDT",
    price: "627.1",
    change: -9.84,
    amount: "137.34M",
    color: "#ecb244",
  },
  {
    icon: "T",
    name: "TSLAUSDT",
    price: "406.78",
    change: 0.84,
    amount: "126.18M",
    color: "#cc0000",
    fee: true,
  },
  {
    icon: "D",
    name: "DOGEUSDT",
    price: "0.1543",
    change: -4.27,
    amount: "124.86M",
    color: "#c3a634",
  },
  {
    icon: "ðŸŒ",
    name: "BANANAS31USDT",
    price: "0.003210",
    change: -23.9,
    amount: "120.72M",
    color: "#ffe135",
  },
  {
    icon: "A",
    name: "ASTERUSDT",
    price: "1.2527",
    change: 1.04,
    amount: "100.25M",
    color: "#9333ea",
  },
  {
    icon: "S",
    name: "SUIUSDT",
    price: "1.6419",
    change: -3.52,
    amount: "85.91M",
    color: "#4da2ff",
  },
  {
    icon: "B",
    name: "BNBUSDT",
    price: "901.83",
    change: -3.68,
    amount: "77.15M",
    color: "#f3ba2f",
  },
  {
    icon: "Z",
    name: "ZENUSDT",
    price: "15.974",
    change: 13.38,
    amount: "74.66M",
    color: "#00d4aa",
  },
  {
    icon: "L",
    name: "LIGHTUSDT",
    price: "1.9104",
    change: 5.54,
    amount: "71.97M",
    color: "#ff6b35",
  },
  {
    icon: "A",
    name: "ADAUSDT",
    price: "0.4687",
    change: -4.99,
    amount: "61.66M",
    color: "#0033ad",
  },
  {
    icon: "L",
    name: "LTCUSDT",
    price: "92.95",
    change: -4.43,
    amount: "60.74M",
    color: "#345d9d",
  },
  {
    icon: "U",
    name: "UNIUSDT",
    price: "7.539",
    change: 2.67,
    amount: "60.03M",
    color: "#ff007a",
    badge: "SuperPairs",
  },
  {
    icon: "S",
    name: "STRKUSDT",
    price: "0.1865",
    change: -12.81,
    amount: "59.63M",
    color: "#ec796b",
  },
  {
    icon: "I",
    name: "ICPUSDT",
    price: "5.602",
    change: 12.69,
    amount: "59.55M",
    color: "#29abe2",
  },
  {
    icon: "H",
    name: "HYPEUSDT",
    price: "40.522",
    change: 4.87,
    amount: "55.67M",
    color: "#00d4ff",
  },
  {
    icon: "P",
    name: "PEPEUSDT",
    price: "0.(5)4814",
    change: -2.49,
    amount: "54.19M",
    color: "#3d9970",
  },
  {
    icon: "W",
    name: "WIFUSDT",
    price: "0.4017",
    change: -3.6,
    amount: "50.81M",
    color: "#8b5a3c",
  },
  {
    icon: "T",
    name: "TAOUSDT",
    price: "324.21",
    change: -0.98,
    amount: "50.54M",
    color: "#000",
  },
  {
    icon: "W",
    name: "WCTUSDT",
    price: "0.1478",
    change: 0.34,
    amount: "46.83M",
    color: "#4a90e2",
  },
  {
    icon: "E",
    name: "ENAUSDT",
    price: "0.2614",
    change: -5.6,
    amount: "43.22M",
    color: "#7c3aed",
  },
  {
    icon: "F",
    name: "FILUSDT",
    price: "2.085",
    change: 4.88,
    amount: "42.32M",
    color: "#0090ff",
  },
  {
    icon: "L",
    name: "LINKUSDT",
    price: "13.381",
    change: -4.17,
    amount: "41.54M",
    color: "#2a5ada",
  },
  {
    icon: "J",
    name: "JCTUSDT",
    price: "0.003954",
    change: 7.56,
    amount: "40.59M",
    color: "#8b5cf6",
    badge: "NEW",
  },
  {
    icon: "Q",
    name: "QUSDT",
    price: "0.01559",
    change: -13.43,
    amount: "37.5M",
    color: "#fbbf24",
  },
  {
    icon: "C",
    name: "CROSSUSDT",
    price: "0.1351",
    change: 30.33,
    amount: "35.4M",
    color: "#10b981",
  },
  {
    icon: "P",
    name: "PUMPUSDT",
    price: "0.003003",
    change: -12.75,
    amount: "32.98M",
    color: "#22c55e",
  },
  {
    icon: "C",
    name: "CRVUSDT",
    price: "0.4140",
    change: -2.54,
    amount: "31.22M",
    color: "#f59e0b",
  },
  {
    icon: "X",
    name: "XVGUSDT",
    price: "0.008522",
    change: 4.89,
    amount: "30.87M",
    color: "#60a5fa",
  },
  {
    icon: "A",
    name: "AVAXUSDT",
    price: "14.405",
    change: -7.52,
    amount: "29.14M",
    color: "#e84142",
  },
  {
    icon: "H",
    name: "HBARUSDT",
    price: "0.1447",
    change: -3.54,
    amount: "27.52M",
    color: "#666",
  },
  {
    icon: "X",
    name: "XAUTUSDT",
    price: "3,987.8",
    change: -1.84,
    amount: "26.58M",
    color: "#f59e0b",
  },
  {
    icon: "X",
    name: "XPLUSDT",
    price: "0.2538",
    change: 11.17,
    amount: "27.56M",
    color: "#94a3b8",
  },
  {
    icon: "A",
    name: "AIAUSDT",
    price: "0.6510",
    change: -16.68,
    amount: "23.95M",
    color: "#3b82f6",
  },
  {
    icon: "A",
    name: "APTUSDT",
    price: "2.7839",
    change: -3.52,
    amount: "21.94M",
    color: "#000",
  },
  {
    icon: "D",
    name: "DOTUSDT",
    price: "2.714",
    change: -3.52,
    amount: "21.91M",
    color: "#e6007a",
  },
  {
    icon: "Q",
    name: "QQUSDT",
    price: "599.56",
    change: -2.37,
    amount: "22.08M",
    color: "#8b5cf6",
    fee: true,
  },
  {
    icon: "W",
    name: "WLFIUSDT",
    price: "0.1383",
    change: -5.98,
    amount: "18.65M",
    color: "#64748b",
  },
  {
    icon: "A",
    name: "AAVEUSDT",
    price: "168.8",
    change: -4.29,
    amount: "19.26M",
    color: "#8b5cf6",
  },
  {
    icon: "R",
    name: "RESOLVUSDT",
    price: "0.1964",
    change: 6.5,
    amount: "18.09M",
    color: "#64748b",
  },
  {
    icon: "N",
    name: "NEARUSDT",
    price: "2.2802",
    change: -1.48,
    amount: "18.88M",
    color: "#000",
  },
  {
    icon: "T",
    name: "TRUMPUSDT",
    price: "6.929",
    change: -1.37,
    amount: "17.88M",
    color: "#fbbf24",
  },
  {
    icon: "L",
    name: "LAUSDT",
    price: "0.4971",
    change: 8.25,
    amount: "17.46M",
    color: "#fbbf24",
  },
  {
    icon: "K",
    name: "KAITOUSDT",
    price: "0.8442",
    change: 11.99,
    amount: "17.58M",
    color: "#10b981",
  },
  {
    icon: "O",
    name: "ONDOUSDT",
    price: "0.5287",
    change: -6.03,
    amount: "16.95M",
    color: "#000",
  },
  {
    icon: "1",
    name: "1000BONKUSDT",
    price: "0.01018",
    change: -4.96,
    amount: "15.98M",
    color: "#fbbf24",
  },
  {
    icon: "S",
    name: "SEIUSDT",
    price: "0.1497",
    change: -5,
    amount: "16.05M",
    color: "#ef4444",
  },
  {
    icon: "Z",
    name: "ZKUSDT",
    price: "0.04544",
    change: -12.2,
    amount: "15.44M",
    color: "#000",
  },
  {
    icon: "F",
    name: "FETUSDT",
    price: "0.2739",
    change: -0.83,
    amount: "15.41M",
    color: "#000",
  },
  {
    icon: "F",
    name: "FARTCOINUSDT",
    price: "0.2479",
    change: 0.41,
    amount: "15.39M",
    color: "#a855f7",
  },
  {
    icon: "S",
    name: "SOONUSDT",
    price: "1.2348",
    change: -34.17,
    amount: "15.52M",
    color: "#ef4444",
  },
  {
    icon: "X",
    name: "XLMUSDT",
    price: "0.2481",
    change: -3.7,
    amount: "14.94M",
    color: "#000",
  },
  {
    icon: "A",
    name: "AIXBTUSDT",
    price: "0.05217",
    change: 0.87,
    amount: "14.61M",
    color: "#8b5cf6",
  },
  {
    icon: "L",
    name: "LDOUSDT",
    price: "0.6983",
    change: -6.44,
    amount: "14.73M",
    color: "#f97316",
  },
  {
    icon: "V",
    name: "VIRTUALUSDT",
    price: "1.0595",
    change: -5,
    amount: "14.31M",
    color: "#10b981",
  },
  {
    icon: "B",
    name: "BCHUSDT",
    price: "484.99",
    change: -0.83,
    amount: "14.02M",
    color: "#8dc351",
  },
  {
    icon: "D",
    name: "DASHUSDT",
    price: "76.36",
    change: -10.16,
    amount: "13.4M",
    color: "#008ce7",
    badge: "SuperPairs",
  },
];

const itemsPerPage = 30;
let currentPage = 1;

// Create ticker
function createTicker() {
  const tickerContent = document.getElementById("tickerContent");
  let tickerHTML = "";
  const tickerData = [...cryptoData, ...cryptoData];

  tickerData.forEach((crypto) => {
    const isPositive = crypto.change > 0;
    const changeClass = isPositive ? "positive" : "negative";
    const changeSign = isPositive ? "+" : "";

    tickerHTML += `
                    <div class="ticker-item">
                        <span class="ticker-pair">${crypto.name.replace(
                          "USDT",
                          " / USDT"
                        )}</span>
                        <span class="ticker-price">${crypto.price}</span>
                        <span class="ticker-change ${changeClass}">${changeSign}${
      crypto.change
    }%</span>
                    </div>
                `;
  });

  tickerContent.innerHTML = tickerHTML;
}

function drawChart(canvasId, change) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;

  const ctx = canvas.getContext("2d");
  const width = 144;
  const height = 40;
  const isPositive = change > 0;
  const color = isPositive ? "#22c55e" : "#ef4444";

  const points = [];
  const numPoints = 20;

  for (let i = 0; i < numPoints; i++) {
    const variance = Math.random() * 15 - 7.5;
    const trend = isPositive ? (i / numPoints) * 15 : -(i / numPoints) * 15;
    const baseValue = height / 2;
    points.push(baseValue - trend + variance);
  }

  ctx.clearRect(0, 0, width, height);
  ctx.beginPath();
  ctx.strokeStyle = color;
  ctx.lineWidth = 2;
  ctx.lineJoin = "round";
  ctx.lineCap = "round";

  points.forEach((point, index) => {
    const x = (index / (numPoints - 1)) * width;
    const y = Math.max(2, Math.min(height - 2, point));

    if (index === 0) {
      ctx.moveTo(x, y);
    } else {
      ctx.lineTo(x, y);
    }
  });

  ctx.stroke();
}

function renderPage(page) {
  // Hide all rows
  const allRows = document.querySelectorAll("#tableBody tr");
  allRows.forEach((row) => {
    const rowPage = row.getAttribute("data-page");
    if (!rowPage) {
      // Page 1 rows (no data-page attribute)
      row.style.display = page === 1 ? "" : "none";
    } else {
      // Other pages
      row.style.display = parseInt(rowPage) === page ? "" : "none";
    }
  });

  // Draw charts for visible rows
  setTimeout(() => {
    document.querySelectorAll("#tableBody tr").forEach((row, index) => {
      if (row.style.display !== "none") {
        const canvas = row.querySelector(".chart");
        const changeCell = row.querySelector(".change");
        const changeText = changeCell.textContent;
        const changeValue = parseFloat(changeText.replace("%", ""));

        if (canvas && !canvas.classList.contains("drawn")) {
          const chartId = "chart_" + Date.now() + "_" + index;
          canvas.id = chartId;
          drawChart(chartId, changeValue);
          canvas.classList.add("drawn");
        }
      }
    });
  }, 10);

  // Star click functionality
  document.querySelectorAll(".star").forEach((star) => {
    star.addEventListener("click", function () {
      this.style.color =
        this.style.color === "rgb(251, 191, 36)" ? "#333" : "#fbbf24";
      this.textContent = this.style.color === "rgb(251, 191, 36)" ? "â˜…" : "â˜†";
    });
  });
}

function goToPage(page) {
  const totalPages = Math.ceil(cryptoData.length / itemsPerPage);
  if (page < 1 || page > totalPages) return;

  currentPage = page;
  renderPage(currentPage);
  updatePagination();
}

function updatePagination() {
  document.querySelectorAll(".page-btn").forEach((btn) => {
    const btnText = btn.textContent.trim();
    if (btnText.match(/^\d+$/)) {
      btn.classList.remove("active");
      if (parseInt(btnText) === currentPage) {
        btn.classList.add("active");
      }
    }
  });
}

function previousPage() {
  if (currentPage > 1) {
    goToPage(currentPage - 1);
  }
}

function nextPage() {
  const totalPages = Math.ceil(cryptoData.length / itemsPerPage);
  if (currentPage < totalPages) {
    goToPage(currentPage + 1);
  }
}

function switchToMarkets() {
  document
    .querySelectorAll(".ticker-tab")
    .forEach((tab) => tab.classList.remove("active"));
  event.target.classList.add("active");
  document.getElementById("marketsPage").classList.add("active");
  document.getElementById("opportunitiesPage").classList.remove("active");
}

function switchToOpportunities() {
  document
    .querySelectorAll(".ticker-tab")
    .forEach((tab) => tab.classList.remove("active"));
  event.target.classList.add("active");
  document.getElementById("marketsPage").classList.remove("active");
  document.getElementById("opportunitiesPage").classList.add("active");

  // Draw trading charts after page is visible
  setTimeout(() => {
    drawFundFlowChart();
    drawBarChart("whaleOrderChart");
    drawLineChart("fundsInflowChart", "#3b82f6");
    drawSmoothLineChart("marginLoanChart", "#3b82f6");
    drawSmoothLineChart2("longShortChart", "#3b82f6");
    drawSmoothLineChart3("marginBorrowChart", "#3b82f6");
  }, 100);
}

function scrollTabsLeft() {
  const tabsContainer = document.getElementById("tabsContainer");
  tabsContainer.scrollBy({ left: -200, behavior: "smooth" });
}

function scrollTabsRight() {
  const tabsContainer = document.getElementById("tabsContainer");
  tabsContainer.scrollBy({ left: 200, behavior: "smooth" });
}

// Initialize
createTicker();
renderPage(1);

// Draw trading charts
function drawFundFlowChart() {
  const canvas = document.getElementById("fundFlowChart");
  if (!canvas) return;
  const ctx = canvas.getContext("2d");

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw donut chart for fund flow
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;
  const radius = 70;
  const innerRadius = 45;

  // Data segments with updated values
  const segments = [
    { color: "#22c55e", percent: 0.2781, label: "Whale buy", value: "27.81%" },
    {
      color: "#10b981",
      percent: 0.1163,
      label: "Dolphin buy",
      value: "11.63%",
    },
    { color: "#14b8a6", percent: 0.0234, label: "Fish buy", value: "2.34%" },
    { color: "#ef4444", percent: 0.582, label: "Whale sell", value: "58.20%" },
    {
      color: "#f87171",
      percent: 0.0001,
      label: "Dolphin sell",
      value: "0.01%",
    },
    { color: "#fca5a5", percent: 0.0001, label: "Fish sell", value: "0.01%" },
  ];

  let startAngle = -Math.PI / 2;

  segments.forEach((seg, index) => {
    const endAngle = startAngle + seg.percent * 2 * Math.PI;

    // Draw segment
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, startAngle, endAngle);
    ctx.arc(centerX, centerY, innerRadius, endAngle, startAngle, true);
    ctx.closePath();
    ctx.fillStyle = seg.color;
    ctx.fill();

    // Only draw labels for visible segments (> 1%)
    if (seg.percent > 0.01) {
      const midAngle = startAngle + (seg.percent * 2 * Math.PI) / 2;

      // Point on the outer edge of segment
      const edgeX = centerX + Math.cos(midAngle) * radius;
      const edgeY = centerY + Math.sin(midAngle) * radius;

      // Point extended outward
      const lineEndX = centerX + Math.cos(midAngle) * (radius + 20);
      const lineEndY = centerY + Math.sin(midAngle) * (radius + 20);

      // Label position
      const isRight = midAngle < Math.PI / 2 || midAngle > (3 * Math.PI) / 2;
      const labelX = isRight ? lineEndX + 5 : lineEndX - 5;
      const labelY = lineEndY;

      // Draw connecting line
      ctx.strokeStyle = "#666";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(edgeX, edgeY);
      ctx.lineTo(lineEndX, lineEndY);
      ctx.stroke();

      // Draw label text
      ctx.fillStyle = "#fff";
      ctx.font = "bold 11px Arial";
      ctx.textAlign = isRight ? "left" : "right";
      ctx.fillText(seg.value, labelX, labelY - 5);

      ctx.fillStyle = "#999";
      ctx.font = "10px Arial";
      ctx.fillText(seg.label, labelX, labelY + 8);
    }

    startAngle = endAngle;
  });

  // Center text
  ctx.fillStyle = "#fff";
  ctx.font = "bold 13px Arial";
  ctx.textAlign = "center";
  ctx.fillText("15m fund flow", centerX, centerY);
}

function drawLineChart(canvasId, color) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const ctx = canvas.getContext("2d");

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Generate smooth data points
  const points = [];
  const numPoints = 60;
  const padding = 40; // Space for labels
  const chartHeight = canvas.height - padding - 20;

  for (let i = 0; i < numPoints; i++) {
    points.push(Math.random() * chartHeight * 0.6 + chartHeight * 0.2);
  }

  const minValue = Math.min(...points);
  const maxValue = Math.max(...points);

  // Draw Y-axis labels (values)
  ctx.fillStyle = "#999";
  ctx.font = "12px Arial";
  ctx.textAlign = "left";

  const yLabels = [
    { value: maxValue, label: "54.5" },
    {
      value: (maxValue + minValue) / 2 + (maxValue - minValue) * 0.25,
      label: "26.5",
    },
    { value: (maxValue + minValue) / 2, label: "-0.5" },
    {
      value: (maxValue + minValue) / 2 - (maxValue - minValue) * 0.25,
      label: "-28.3",
    },
    { value: minValue, label: "-55.8" },
  ];

  yLabels.forEach((item) => {
    const y =
      padding + ((maxValue - item.value) / (maxValue - minValue)) * chartHeight;
    ctx.fillText(item.label, 5, y + 3);
  });

  // Draw X-axis labels (time)
  ctx.textAlign = "center";
  const timeLabels = ["20:15", "04:00", "12:00", "20:00"];
  timeLabels.forEach((label, index) => {
    const x =
      padding +
      (index / (timeLabels.length - 1)) * (canvas.width - padding - 10);
    ctx.fillText(label, x, canvas.height - 5);
  });

  // Draw line with rounded joins
  ctx.beginPath();
  ctx.strokeStyle = color;
  ctx.lineWidth = 2;
  ctx.lineCap = "round";
  ctx.lineJoin = "round";

  points.forEach((point, index) => {
    const x =
      padding + (index / (numPoints - 1)) * (canvas.width - padding - 10);
    const y =
      padding + ((maxValue - point) / (maxValue - minValue)) * chartHeight;
    if (index === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });

  ctx.stroke();
}

function drawBarChart(canvasId) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const ctx = canvas.getContext("2d");

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Data with dates and values matching the image
  const bars = [
    { value: -256.834185, color: "#ef4444", date: "11/20" },
    { value: -1400, color: "#ef4444", date: "11/21" },
    { value: -540.152503, color: "#ef4444", date: "11/22" },
    { value: -408.020704, color: "#ef4444", date: "11/23" },
    { value: -297.711435, color: "#ef4444", date: "11/24" },
  ];

  const barWidth = 30; // Fixed narrow width like in image
  const spacing = (canvas.width - bars.length * barWidth) / (bars.length + 1);
  const maxValue = Math.max(...bars.map((b) => Math.abs(b.value)));
  const centerY = canvas.height / 2;

  bars.forEach((bar, index) => {
    const x = spacing + index * (barWidth + spacing);
    const height = (Math.abs(bar.value) / maxValue) * (canvas.height / 2 - 40);
    const y = bar.value < 0 ? centerY : centerY - height;

    // Draw bar
    ctx.fillStyle = bar.color;
    ctx.fillRect(x, y, barWidth, height);

    // Draw value above/below bar
    ctx.fillStyle = "#fff";
    ctx.font = "11px Arial";
    ctx.textAlign = "center";
    const valueY = bar.value < 0 ? y + height + 15 : y - 5;
    ctx.fillText(bar.value.toFixed(0), x + barWidth / 2, valueY);

    // Draw date at bottom
    ctx.fillStyle = "#999";
    ctx.font = "10px Arial";
    ctx.fillText(bar.date, x + barWidth / 2, canvas.height - 5);
  });

  // Draw center line
  ctx.strokeStyle = "#333";
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(0, centerY);
  ctx.lineTo(canvas.width, centerY);
  ctx.stroke();
}

function drawSmoothLineChart(canvasId, color) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const ctx = canvas.getContext("2d");

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Generate data with multiple smooth peaks (around 20 peaks)
  const numPoints = 200;
  const padding = 40;
  const chartHeight = canvas.height - padding - 20;

  // Create wave with multiple peaks
  const points = [];
  for (let i = 0; i < numPoints; i++) {
    const t = i / numPoints;
    // Base wave with multiple frequencies to create ~20 peaks
    let value = Math.sin(t * Math.PI * 20) * 0.15; // Small ripples
    value += Math.sin(t * Math.PI * 4) * 0.25; // Medium waves
    value += Math.sin(t * Math.PI * 1) * 0.3; // Large wave
    // Add one major spike around 30% position
    if (t > 0.28 && t < 0.32) {
      value += Math.sin(((t - 0.28) * Math.PI) / 0.04) * 1.2;
    }
    // Add medium spike around 85% position
    if (t > 0.83 && t < 0.87) {
      value += Math.sin(((t - 0.83) * Math.PI) / 0.04) * 0.5;
    }
    // Normalize to chart space
    points.push(chartHeight * 0.5 + value * chartHeight * 0.35);
  }

  const minValue = Math.min(...points);
  const maxValue = Math.max(...points);

  // Draw Y-axis labels
  ctx.fillStyle = "#999";
  ctx.font = "12px Arial";
  ctx.textAlign = "left";

  const yLabels = [
    { value: maxValue, label: "60.84" },
    { value: (maxValue + minValue) / 2, label: "26.48" },
    { value: minValue, label: "-7.08" },
  ];

  yLabels.forEach((item) => {
    const y =
      padding + ((maxValue - item.value) / (maxValue - minValue)) * chartHeight;
    ctx.fillText(item.label, 5, y + 3);
  });

  // Draw line with smooth rounded joins
  ctx.beginPath();
  ctx.strokeStyle = color;
  ctx.lineWidth = 2;
  ctx.lineCap = "round";
  ctx.lineJoin = "round";

  points.forEach((point, index) => {
    const x =
      padding + (index / (numPoints - 1)) * (canvas.width - padding - 10);
    const y =
      padding + ((maxValue - point) / (maxValue - minValue)) * chartHeight;
    if (index === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });

  ctx.stroke();
}

function drawSmoothLineChart2(canvasId, color) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const ctx = canvas.getContext("2d");

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Generate different wave pattern - starting high and descending
  const numPoints = 200;
  const padding = 40;
  const chartHeight = canvas.height - padding - 20;

  // Create wave with different pattern - starts high, gradual descent with peaks
  const points = [];
  for (let i = 0; i < numPoints; i++) {
    const t = i / numPoints;
    // Different frequencies for varied pattern
    let value = Math.sin(t * Math.PI * 18) * 0.12; // Small ripples
    value += Math.sin(t * Math.PI * 3.5) * 0.2; // Medium waves
    value += Math.cos(t * Math.PI * 1.5) * 0.35; // Descending wave using cosine
    // Add spike at beginning around 5% position
    if (t > 0.02 && t < 0.08) {
      value += Math.sin(((t - 0.02) * Math.PI) / 0.06) * 0.8;
    }
    // Add medium spike around 60% position
    if (t > 0.58 && t < 0.64) {
      value += Math.sin(((t - 0.58) * Math.PI) / 0.06) * 0.4;
    }
    // Normalize to chart space
    points.push(chartHeight * 0.5 + value * chartHeight * 0.35);
  }

  const minValue = Math.min(...points);
  const maxValue = Math.max(...points);

  // Draw Y-axis labels with different values
  ctx.fillStyle = "#999";
  ctx.font = "12px Arial";
  ctx.textAlign = "left";

  const yLabels = [
    { value: maxValue, label: "49.36" },
    { value: (maxValue + minValue) / 2, label: "43.90" },
    { value: minValue, label: "40.00" },
  ];

  yLabels.forEach((item) => {
    const y =
      padding + ((maxValue - item.value) / (maxValue - minValue)) * chartHeight;
    ctx.fillText(item.label, 5, y + 3);
  });

  // Draw line with smooth rounded joins
  ctx.beginPath();
  ctx.strokeStyle = color;
  ctx.lineWidth = 2;
  ctx.lineCap = "round";
  ctx.lineJoin = "round";

  points.forEach((point, index) => {
    const x =
      padding + (index / (numPoints - 1)) * (canvas.width - padding - 10);
    const y =
      padding + ((maxValue - point) / (maxValue - minValue)) * chartHeight;
    if (index === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });

  ctx.stroke();
}

function drawSmoothLineChart3(canvasId, color) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const ctx = canvas.getContext("2d");

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Generate another different wave pattern - with larger peak at end
  const numPoints = 200;
  const padding = 40;
  const chartHeight = canvas.height - padding - 20;

  // Create wave with peak at the end
  const points = [];
  for (let i = 0; i < numPoints; i++) {
    const t = i / numPoints;
    // Different wave composition
    let value = Math.sin(t * Math.PI * 22) * 0.1; // Small ripples
    value += Math.sin(t * Math.PI * 5) * 0.2; // Medium waves
    value += Math.sin(t * Math.PI * 0.8) * 0.25 - 0.2; // Gentle rise
    // Add spike at beginning around 8% position
    if (t > 0.06 && t < 0.12) {
      value += Math.sin(((t - 0.06) * Math.PI) / 0.06) * 0.6;
    }
    // Add large spike around 90% position
    if (t > 0.88 && t < 0.94) {
      value += Math.sin(((t - 0.88) * Math.PI) / 0.06) * 1.5;
    }
    // Add medium spike around 55% position
    if (t > 0.52 && t < 0.58) {
      value += Math.sin(((t - 0.52) * Math.PI) / 0.06) * 0.45;
    }
    // Normalize to chart space
    points.push(chartHeight * 0.5 + value * chartHeight * 0.35);
  }

  const minValue = Math.min(...points);
  const maxValue = Math.max(...points);

  // Draw Y-axis labels with different values
  ctx.fillStyle = "#999";
  ctx.font = "12px Arial";
  ctx.textAlign = "left";

  const yLabels = [
    { value: maxValue, label: "16.09" },
    { value: (maxValue + minValue) / 2, label: "5.85" },
    { value: minValue, label: "-1.46" },
  ];

  yLabels.forEach((item) => {
    const y =
      padding + ((maxValue - item.value) / (maxValue - minValue)) * chartHeight;
    ctx.fillText(item.label, 5, y + 3);
  });

  // Draw line with smooth rounded joins
  ctx.beginPath();
  ctx.strokeStyle = color;
  ctx.lineWidth = 2;
  ctx.lineCap = "round";
  ctx.lineJoin = "round";

  points.forEach((point, index) => {
    const x =
      padding + (index / (numPoints - 1)) * (canvas.width - padding - 10);
    const y =
      padding + ((maxValue - point) / (maxValue - minValue)) * chartHeight;
    if (index === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });

  ctx.stroke();
}

// Draw charts when switching to Opportunities tab
setTimeout(() => {
  if (document.getElementById("fundFlowChart")) {
    drawFundFlowChart();
    drawBarChart("whaleOrderChart");
    drawLineChart("fundsInflowChart", "#3b82f6");
    drawSmoothLineChart("marginLoanChart", "#3b82f6");
    drawSmoothLineChart2("longShortChart", "#3b82f6");
    drawSmoothLineChart3("marginBorrowChart", "#3b82f6");
  }
}, 100);
